%% initialize value
syms q_1_n q_2_n q_3_n v_1_n v_2_n v_3_n 

q_container = zeros(3, pressure_size); 
v_container = zeros(3, pressure_size); 
w_H_1h_ = zeros(4,4); % coordinatetransform matrix head to worldframe

dw_H_1h__dq1_ = zeros(4,4); %first derrivative of H_1h after q_1
dw_H_1h__dq2_ = zeros(4,4);
dw_H_1h__dq3_ = zeros(4,4);

w_H_2dot_ = zeros(4,1);

v_1_ = 0;
v_2_ = 0;
v_3_ = 0;

q_1_ = 0.301401; 
q_2_ = 0.3014;
q_3_ = 0.3014;
pressure_total= zeros(12,10000);
pressure_total(2,:) = 0.05;
for i =  2:pressure_size %6967
 
   q_container(1,i-1) = q_1_;
   q_container(2,i-1) = q_2_; 
   q_container(3,i-1) = q_3_;
   
   v_container(1,i-1) = v_1_;
   v_container(2,i-1) = v_2_;
   v_container(3,i-1) = v_3_;
 
   dt = pressure_time(i)-pressure_time(i-1);
  
   [w_H_1h_, w_H_2dot_,dw_H_1h__dq1_, dw_H_1h__dq2_, dw_H_1h__dq3_, q_dot_, kappa_, l_bar_, phi_]= SetMatrices(dt, real(q_1_), real(q_2_), real(q_3_), real(v_1_), real(v_2_), real(v_3_));
   [generalized_force_term_] = GetGeneralizedForceTerm(w_H_1h_, dw_H_1h__dq1_,dw_H_1h__dq2_, dw_H_1h__dq3_, real(q_1_), real(q_2_), real(q_3_), 10^5*pressure_total(2,i-1), 10^5*pressure_total(7,i-1), 10^5*pressure_total(9,i-1), v_1_,v_2_,v_3_);
   [bending_stiffness_derivative_] = GetBendingStiffnessDeriv(10^5*pressure_total(2,i-1), 10^5*pressure_total(7,i-1), 10^5*pressure_total(9,i-1), kappa_*l_bar_, phi_,q_1_,q_2_,q_3_);
   [kinetic_energy_term_] = GetKineticEnergyTerm(dw_H_1h__dq1_, dw_H_1h__dq2_, dw_H_1h__dq3_, w_H_2dot_);
   [potential_energy_term_] = GetPotentialEnergyTerm(real(q_1_), real(q_2_), real(q_3_), dw_H_1h__dq1_,dw_H_1h__dq2_, dw_H_1h__dq3_, kappa_, l_bar_, phi_, bending_stiffness_derivative_);
   
   [q_1_, q_2_, q_3_, v_1_, v_2_, v_3_] = LagrangeEquation(generalized_force_term_, kinetic_energy_term_, potential_energy_term_, q_dot_, real(v_1_), real(v_2_), real(v_3_))
   
end